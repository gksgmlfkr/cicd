
<html layout:decorate="~{layout}">
  <!-- layout.html 상속 -->
  <div layout:fragment="content" style="width: 100%; margin: 50px auto; text-align: center;">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
  <style>
  body{
    background-color: black;
  }
  /* ============ 캐러셀 CSS 코드 ==================*/
        /* 캐러셀 컨테이너 스타일 */
        .slider {
            overflow: hidden;
            position: relative;
            max-width: 800px; /* 전체 가로폭을 줄이는 부분 */
            width: 100%;
            height:10%;
            margin: 50px auto 0;
            border-radius: 7px;
        }

        .slider .inner {
            overflow: hidden;
        }

        .slide_list > li {
            width: 100%;
            height: 200px;
            background: #8ab4f8;
            font-size: 20px;
            line-height: 150px;
            text-align: center;
            box-sizing: border-box; /* box-sizing을 추가하여 padding과 border를 포함하도록 설정 */
            border-radius: 7px;
        }

        .slider .btn {
            position: absolute;
            top: 50%;
            width: 35px;
            height: 35px;
            background:url('images/arrow.png') center center no-repeat;
            background-size: cover;
            text-indent: -999em;
            cursor: pointer;
            z-index: 10;
            transform: translateY(-50%);
        }

        .slider .btn.btn_prev {
            left: 0;
            transform: rotateY(180deg) translateY(-50%);
        }

        .slider .btn.btn_next {
            right: 0;
            transform: translateY(-50%);
        }
/* ============ 캐러셀 CSS 코드 끝==================*/

/* ============ 운동시간 CSS 30분단위 ============  */
        .container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .duration {
            font-size: 24px;
            color: white;
        }
/* ============ 운동시간 CSS 30분단위 ============  */
</style>
<link rel="stylesheet" type="text/css" href="slick/slick.css"/>
<link rel="stylesheet" type="text/css" href="slick/slick-theme.css"/>





  
    <!-- 뒤로가기 와 기록추가버튼 -->
    <div style="float:left">
      <span id="history_back" style="font-size: 15px; color: white;" onclick="history.back()">◀ 뒤로가기</span>
    </div>
    <div id="btn_insert" style="float:right; ">
      <span style="font-size: 17px; color: #58FAAC;">추가</span>
    </div>
    <div style="clear: both;">
    </div>
    <!-- 뒤로가기 와 기록추가버튼 -->
    
    
    
    <br>
    <div>
      <span style="color: white; font-size: 24px;">운동 기록</span>
    </div>
    <div>
      <span id="msg"style="color: red; font-size: 13px;"></span>
    </div>
    
  <div>


    <!-- 캐러셀 슬라이드 -->
    <div class="slider">
        <div class="inner swiper-container">
            <ul class="swiper-wrapper slide_list">
                <li class="swiper-slide">헬스</li>
                <li class="swiper-slide">유산소</li>
                <li class="swiper-slide">등산</li>
                <li class="swiper-slide">기타스포츠</li>
            </ul>
        </div>
        <span class="btn btn_prev">이전</span>
        <span class="btn btn_next">다음</span>
    </div>
    <!-- 캐러셀 슬라이드 -->


  </div>
    
      <!-- 운동 기록 입력 -->
      <div>
        
        <!-- 운동명 입력 -->
        <input id="exname" name="exname" class="form-control form-control-lg" type="text" placeholder="운동명" aria-label=".form-control-lg example">
        <br>
        
        <!-- 운동유형 입력 -->
        <input id="extype" name="extype" class="form-control form-control-lg" type="text" placeholder="유형" aria-label=".form-control-lg example">
        <br>
        <!-- 칼로리 입력 -->
        <div style="display: flex;">
          <input id="hiscalorie" name="hiscalorie" class="form-control form-control-lg" type="text"
          style="width: 80%;" placeholder="칼로리" aria-label=".form-control-lg example">
          <span style="font-size: 24px; color: white; margin: auto;">kcal</span>
        </div>
        <br>
        
        <!-- 운동 시간 입력 -->
        <span style="font-size: 17px; color: white;">운동 시간(30분 단위)</span>
        <div class="container">
          <button class="btn btn-primary" id="decrease">-</button>
          <div id="duration" name="duration" class="duration">0</div>
          <button class="btn btn-primary" id="increase">+</button>
        </div>
        <br>
        
        <!-- 메모 입력 -->
        <div class="mb-3">
          <label for="notes" class="form-label">운동 메모</label>
          <textarea id="notes" name="notes" class="form-control" placeholder="메모를 입력하세요..." rows="3"></textarea>
        </div>
        
        <!-- 이미지 입력 -->
        <div class="input-group mb-3">
          <input type="file" class="form-control" id="inputGroupFile02">
          <label class="input-group-text" for="inputGroupFile02">Upload</label>
        </div>
        
      </div>
      <!-- 운동 기록 입력 -->
    
    <br>
    <br>
    <div style="text-align: center; border-radius: 7px; padding: 12px; background-color: #2e2d2d;">    
      <span style="font-size: 20px; color: #58FAAC;">+ &nbsp;상세 기록</span>
    </div>
    

   <!-- 캐러셀 자바스크립트 코드 -->       
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(window).on('load', function () {
          slider(); 
        });
              
        $(document).ready(function() {
          let value = 0;
      
          function updateValue() {
            $('#duration').text(value);
          }
      
          $('#decrease').click(function() {
            if (value - 30 >= 0) {
              value -= 30;
              updateValue();
            }
          });
      
          $('#increase').click(function() {
            value += 30;
            updateValue();
          });
      
          // 초기값 설정
          updateValue();
        });
        
        
              
        function slider(){
            $(".slider").each(function(index){
                let $this = $(this);
                let swiper = undefined;
                let slideNum =  $this.find('.swiper-slide').length; //슬라이드 총 개수
                let slideInx = 0; //현재 슬라이드 index
                
                //디바이스 체크
                let oldWChk = window.innerWidth > 768 ? 'pc' : 'mo';
                sliderAct();
                $(window).on('resize', function () {
                    let newWChk = window.innerWidth > 768 ? 'pc' : 'mo';
                    if(newWChk != oldWChk){
                        oldWChk = newWChk;
                        sliderAct();
                    }
                });

                function sliderAct(){
                    //슬라이드 인덱스 클래스 추가
                    $this.addClass(`slider${index}`);

                    //슬라이드 초기화 
                    if (swiper != undefined){ 
                        swiper.destroy();
                        swiper = undefined;
                    }

                    //slidesPerView 옵션 설정
                    let viewNum = oldWChk == 'pc' ? 5 : 2;
                    //loop 옵션 체크
                    let loopChk = slideNum > viewNum;

                    swiper = new Swiper(`.slider${index} .swiper-container`, {
                        slidesPerView: viewNum,
                        initialSlide :slideInx,
                        spaceBetween: 10,
                        slidesPerGroup: 1,
                        loop: loopChk,
                        navigation: {
                            prevEl: $(`.slider${index} .btn_prev`)[0],
                            nextEl: $(`.slider${index} .btn_next`)[0],
                        },
                        on: {
                            activeIndexChange: function () {
                                slideInx = this.realIndex; //현재 슬라이드 index 갱신
                            }
                        },
                    });
                }
            });
        }
        
        
        
         document.getElementById('btn_insert').addEventListener('click', (event) => {
                     let duration = document.getElementById("duration").value;
          alert("duration" + duration) 
          alert("안녕");
          insert_history()
        })

        function insert_history(){
          let exname = document.getElementById("exname").value;
          let extype = document.getElementById("extype").value;
          let hiscalorie = document.getElementById("hiscalorie").value;
          let duration = document.getElementById("duration").value;
          let notes = document.getElementById("notes").value;     
          let memberno = '[[${session.memberno}]]';   
          let msg = document.getElementById('msg')  
          
          alert("duration" + duration)
          fetch('/history/history_record_proc' , {
            method : 'POST',
            headers: {
              'Content-Type': 'application/json'  // 요청의 콘텐츠 타입을 JSON으로 설정
            },
            body: JSON.stringify({
              exname:exname,
              extype:extype,
              hiscalorie:hiscalorie,
              duration:duration,
              notes:notes,
              memberno:memberno
            })
          })
          .then(response => response.json())
          .then(data => {
            if(data['cnt'] == 1){
              console.log('성공;');
              window.location.href = '/history/recored_ssuccess';
              
            } else{
              console.log('실패');
              msg.innerHTML = '입력을 똑바로 해주시오'
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
        }
    </script>
    <!-- 캐러셀 자바스크립트 코드 끝 -->

    
    
  </div>
</html>